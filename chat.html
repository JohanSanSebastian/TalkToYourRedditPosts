<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit AI Conversation</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="title" onclick="goToHomePage()">Talk to your reddit posts</div>
    <div class="container" id="conversation"></div>
    <div class="input-container">
        <input type="text" id="userInput" placeholder="Ask something..." />
        <button onclick="askQuestion()">Send</button>
    </div>

    <script>
        let conversationHistory = '';
        const redditUrl = new URLSearchParams(window.location.search).get('reddit_url');

        async function fetchRedditData() {
            const response = await fetch(`https://www.reddit.com/${redditUrl}.json`, {
                headers: { 'User-agent': 'your bot 0.1' }
            });
            const data = await response.json();
            if (data) {
                const postText = data[0].data.children[0].data.selftext;
                const comments = data[1].data.children.map(comment => comment.data.body).join('\n\n');

                conversationHistory = `${postText}\n\n${comments}`;

                // Generate a summary using a placeholder
                const summary = "This is a placeholder summary of the Reddit post contents.";

                addMessageToChat('AI', summary, true); // Add summary as the first message
                addMessageToChat('AI', conversationHistory, true); // Add the rest of the conversation
            } else {
                alert('Error fetching Reddit data.');
            }
        }

        function addMessageToChat(sender, message, isMarkdown = false) {
            const conversation = document.getElementById('conversation');
            const messageElement = document.createElement('div');
            messageElement.className = sender === 'User' ? 'user-message chat' : 'ai-message chat';

            if (isMarkdown) {
                messageElement.innerHTML = marked.parse(message);
            } else {
                messageElement.innerText = message;
            }

            conversation.appendChild(messageElement);
            conversation.scrollTop = conversation.scrollHeight;
        }

        async function askQuestion() {
            const userInput = document.getElementById('userInput').value;
            if (!userInput) return;

            addMessageToChat('User', userInput);

            // Show loading animation
            const loadingMessage = document.createElement('div');
            loadingMessage.className = 'ai-message chat loading';
            document.getElementById('conversation').appendChild(loadingMessage);

            // Simulate AI response with a placeholder
            setTimeout(() => {
                loadingMessage.remove();
                const aiResponse = "This is a placeholder response from the AI.";
                addMessageToChat('AI', aiResponse, true);
            }, 2000);

            document.getElementById('userInput').value = '';
        }

        document.getElementById('userInput').addEventListener('keydown', function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                askQuestion();
            }
        });

        function goToHomePage() {
            window.location.href = "index.html";
        }

        window.onload = fetchRedditData;
    </script>
</body>
</html>
